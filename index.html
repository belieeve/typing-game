<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>„Çø„Ç§„Éî„É≥„Ç∞ „Éà„É¨„Éº„Éä„Éº</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 10px;
            overflow: hidden;
        }

        .game-container {
            background: white;
            border-radius: 15px;
            padding: 10px 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 1200px;
            width: 100%;
            max-height: 98vh;
            overflow-y: auto;
        }

        .header {
            text-align: center;
            margin-bottom: 5px;
        }

        .title {
            font-size: 24px;
            font-weight: bold;
            background: linear-gradient(45deg, #FF6B6B, #4ECDC4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 3px;
        }

        .level-info {
            display: flex;
            justify-content: space-around;
            margin-bottom: 5px;
            font-size: 16px;
            font-weight: bold;
        }

        .level-badge {
            background: linear-gradient(135deg, #FF6B6B, #FFE66D);
            color: white;
            padding: 5px 15px;
            border-radius: 50px;
            box-shadow: 0 5px 15px rgba(255,107,107,0.4);
        }

        .score-badge {
            background: linear-gradient(135deg, #4ECDC4, #44A08D);
            color: white;
            padding: 5px 15px;
            border-radius: 50px;
            box-shadow: 0 5px 15px rgba(78,205,196,0.4);
        }

        .game-screen {
            text-align: center;
            margin: 5px 0;
        }

        .start-screen {
            display: block;
        }

        .play-screen {
            display: none;
        }

        .start-button {
            font-size: 24px;
            padding: 12px 35px;
            background: linear-gradient(135deg, #FF6B6B, #FF8E53);
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-weight: bold;
            box-shadow: 0 10px 30px rgba(255,107,107,0.4);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .start-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(255,107,107,0.6);
        }

        .start-button:active {
            transform: translateY(-1px);
        }

        .question-area {
            margin: 5px 0;
            padding: 10px;
            background: linear-gradient(135deg, #FFF9C4, #FFEB3B);
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .question-hiragana {
            font-size: 56px;
            font-weight: bold;
            color: #333;
            margin-bottom: 3px;
        }

        .question-romaji {
            font-size: 24px;
            color: #666;
            font-family: monospace;
            letter-spacing: 2px;
        }

        .input-display {
            font-size: 32px;
            color: #4ECDC4;
            font-family: monospace;
            letter-spacing: 4px;
            margin: 5px 0;
            min-height: 40px;
        }

        .keyboard {
            display: grid;
            gap: 2px;
            margin: 5px auto;
            max-width: 600px;
        }

        .keyboard-row {
            display: flex;
            justify-content: center;
            gap: 2px;
        }

        .key {
            background: #f0f0f0;
            border: 2px solid #ccc;
            border-radius: 4px;
            padding: 6px;
            min-width: 35px;
            font-size: 14px;
            font-weight: bold;
            text-align: center;
            transition: all 0.2s;
        }

        .key.highlight {
            background: linear-gradient(135deg, #FF6B6B, #FFE66D);
            border-color: #FF6B6B;
            color: white;
            transform: scale(1.2);
            box-shadow: 0 0 30px rgba(255,107,107,0.8);
            animation: pulse 0.6s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1.2); }
            50% { transform: scale(1.3); }
        }

        .key.space {
            min-width: 300px;
        }

        .progress-bar {
            width: 100%;
            height: 15px;
            background: #e0e0e0;
            border-radius: 8px;
            overflow: hidden;
            margin: 5px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4ECDC4, #44A08D);
            transition: width 0.3s;
            border-radius: 8px;
        }

        .romaji-guide {
            margin-top: 5px;
            padding: 8px;
            background: #f9f9f9;
            border-radius: 8px;
            max-height: 100px;
            overflow-y: auto;
        }

        .romaji-guide h3 {
            margin-bottom: 5px;
            color: #333;
            font-size: 14px;
        }

        .guide-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(60px, 1fr));
            gap: 4px;
        }

        .guide-item {
            padding: 4px;
            background: white;
            border-radius: 4px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .guide-hiragana {
            font-size: 16px;
            font-weight: bold;
            color: #333;
        }

        .guide-romaji {
            font-size: 11px;
            color: #666;
            font-family: monospace;
        }

        .feedback {
            font-size: 22px;
            font-weight: bold;
            margin: 5px 0;
            min-height: 28px;
        }

        .feedback.correct {
            color: #4ECDC4;
            animation: bounce 0.5s;
        }

        .feedback.wrong {
            color: #FF6B6B;
            animation: shake 0.5s;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0) scale(1); }
            25% { transform: translateY(-15px) scale(1.1); }
            50% { transform: translateY(-20px) scale(1.15); }
            75% { transform: translateY(-10px) scale(1.05); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        .question-area {
            transition: background 0.5s ease;
        }

        .level-up {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 40px;
            border-radius: 25px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            display: none;
            z-index: 1000;
            text-align: center;
        }

        .level-up.show {
            display: block;
            animation: zoomIn 0.5s, celebrate 0.5s ease-in-out 0.2s;
        }

        @keyframes zoomIn {
            from {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.5);
            }
            to {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
        }

        @keyframes celebrate {
            0%, 100% { transform: translate(-50%, -50%) rotate(0deg); }
            25% { transform: translate(-50%, -50%) rotate(-5deg); }
            75% { transform: translate(-50%, -50%) rotate(5deg); }
        }

        .level-up h2 {
            font-size: 48px;
            background: linear-gradient(45deg, #FF6B6B, #4ECDC4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 15px;
        }

        .level-up button {
            font-size: 24px;
            padding: 15px 40px;
            background: linear-gradient(135deg, #4ECDC4, #44A08D);
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-weight: bold;
            margin-top: 15px;
            transition: transform 0.2s;
        }

        .level-up button:hover {
            transform: scale(1.05);
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: none;
            z-index: 999;
        }

        .overlay.show {
            display: block;
        }

        .home-button {
            position: absolute;
            top: 10px;
            right: 10px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 15px;
            padding: 6px 12px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            transition: transform 0.2s;
            display: none;
        }

        .home-button:hover {
            transform: translateY(-2px);
        }

        .home-button.show {
            display: block;
        }
    </style>
</head>
<body>
    <div class="game-container" style="position: relative;">
        <button class="home-button" id="homeButton" onclick="goHome()">üè† „Éà„ÉÉ„Éó„Å∏</button>
        <div class="header">
            <div class="title">‚ö° „Çø„Ç§„Éî„É≥„Ç∞ „Éà„É¨„Éº„Éä„Éº ‚ö°</div>
        </div>

        <div class="level-info">
            <div class="level-badge">„É¨„Éô„É´ <span id="level">1</span></div>
            <div class="score-badge">„Çπ„Ç≥„Ç¢ <span id="score">0/3</span></div>
        </div>

        <div class="progress-bar">
            <div class="progress-fill" id="progress"></div>
        </div>

        <div class="game-screen">
            <div class="start-screen" id="startScreen">
                <p style="font-size: 18px; margin-bottom: 8px;">„Åç„Åø„ÅØ „Çø„Ç§„Éî„É≥„Ç∞ „Éà„É¨„Éº„Éä„Éº „Å†ÔºÅ</p>
                <p style="font-size: 14px; margin-bottom: 12px; color: #666;">„ÇÇ„Åò„Çí „ÅÜ„Å£„Å¶ „É¨„Éô„É´„Ç¢„ÉÉ„Éó „Åó„Çà„ÅÜÔºÅ</p>
                <button class="start-button" onclick="startGame()">„Çπ„Çø„Éº„ÉàÔºÅ</button>
            </div>

            <div class="play-screen" id="playScreen">
                <div class="question-area" id="questionArea">
                    <div class="question-hiragana" id="questionHiragana">„ÅÇ</div>
                    <div class="question-romaji" id="questionRomaji">a</div>
                </div>

                <div class="input-display" id="inputDisplay"></div>
                <div class="feedback" id="feedback"></div>

                <div class="keyboard" id="keyboard"></div>
            </div>
        </div>

        <div class="romaji-guide">
            <h3>üìñ „É≠„Éº„Éû„Åò „Å≤„Çá„ÅÜ</h3>
            <div class="guide-grid" id="guideGrid"></div>
        </div>
    </div>

    <div class="overlay" id="overlay"></div>
    <div class="level-up" id="levelUpScreen">
        <h2>üéâ „É¨„Éô„É´„Ç¢„ÉÉ„ÉóÔºÅ</h2>
        <p style="font-size: 28px; margin: 15px 0;">„É¨„Éô„É´ <span id="newLevel"></span> „Å´„Å™„Å£„Åü„ÇàÔºÅ</p>
        <button onclick="continuePlaying()">„Å§„Åé„Å∏ÔºÅ</button>
    </div>

    <script>
        // „Ç≤„Éº„É†„Éá„Éº„Çø
        const levels = [
            { level: 1, chars: ['„ÅÇ', '„ÅÑ', '„ÅÜ', '„Åà', '„Åä'], questionsToPass: 3, hintRate: 1.0, theme: '#FFF9C4' },
            { level: 2, chars: ['„ÅÇ', '„ÅÑ', '„ÅÜ', '„Åà', '„Åä', '„Åã', '„Åç', '„Åè', '„Åë', '„Åì'], questionsToPass: 3, hintRate: 1.0, theme: '#FFF9C4' },
            { level: 3, chars: ['„Åã', '„Åç', '„Åè', '„Åë', '„Åì', '„Åï', '„Åó', '„Åô', '„Åõ', '„Åù'], questionsToPass: 5, hintRate: 1.0, theme: '#E1F5DD' },
            { level: 4, chars: ['„Åï', '„Åó', '„Åô', '„Åõ', '„Åù', '„Åü', '„Å°', '„Å§', '„Å¶', '„Å®'], questionsToPass: 5, hintRate: 0.5, theme: '#E1F5DD' },
            { level: 5, chars: ['„Åü', '„Å°', '„Å§', '„Å¶', '„Å®', '„Å™', '„Å´', '„Å¨', '„Å≠', '„ÅÆ'], questionsToPass: 5, hintRate: 0.5, theme: '#D4E9FF' },
            { level: 6, chars: ['„Å™', '„Å´', '„Å¨', '„Å≠', '„ÅÆ', '„ÅØ', '„Å≤', '„Åµ', '„Å∏', '„Åª'], questionsToPass: 5, hintRate: 0.5, theme: '#D4E9FF' },
            { level: 7, chars: ['„ÅØ', '„Å≤', '„Åµ', '„Å∏', '„Åª', '„Åæ', '„Åø', '„ÇÄ', '„ÇÅ', '„ÇÇ'], questionsToPass: 7, hintRate: 0.33, theme: '#FFE8F0' },
            { level: 8, chars: ['„Åæ', '„Åø', '„ÇÄ', '„ÇÅ', '„ÇÇ', '„ÇÑ', '„ÇÜ', '„Çà', '„Çâ', '„Çä'], questionsToPass: 7, hintRate: 0.33, theme: '#FFE8F0' },
            { level: 9, chars: ['„ÇÑ', '„ÇÜ', '„Çà', '„Çâ', '„Çä', '„Çã', '„Çå', '„Çç', '„Çè', '„Çí'], questionsToPass: 7, hintRate: 0.33, theme: '#FFF0E1' },
            { level: 10, chars: ['„Çâ', '„Çä', '„Çã', '„Çå', '„Çç', '„Çè', '„Çí', '„Çì'], questionsToPass: 7, hintRate: 0, theme: '#FFF0E1' },
            { level: 11, chars: ['„Åå', '„Åé', '„Åê', '„Åí', '„Åî', '„Åñ', '„Åò', '„Åö', '„Åú', '„Åû'], questionsToPass: 7, hintRate: 0, theme: '#E8E1FF' },
            { level: 12, chars: ['„Å†', '„Å¢', '„Å•', '„Åß', '„Å©', '„Å∞', '„Å≥', '„Å∂', '„Åπ', '„Åº'], questionsToPass: 7, hintRate: 0, theme: '#E8E1FF' },
            { level: 13, chars: ['„Å±', '„Å¥', '„Å∑', '„Å∫', '„ÅΩ'], questionsToPass: 5, hintRate: 0, theme: '#FFE1F0' },
            { level: 14, chars: ['„Åç„ÇÉ', '„Åç„ÇÖ', '„Åç„Çá', '„Åó„ÇÉ', '„Åó„ÇÖ', '„Åó„Çá', '„Å°„ÇÉ', '„Å°„ÇÖ', '„Å°„Çá'], questionsToPass: 7, hintRate: 0, theme: '#FFE1F0' },
            { level: 15, chars: ['„Å≠„Åì', '„ÅÑ„Å¨', '„ÅÜ„Åæ', '„Å®„Çä', '„Åï„Åã„Å™', '„ÅØ„Å™', '„Åù„Çâ', '„Åã„Çè'], questionsToPass: 8, hintRate: 0, theme: '#FFD4E8' }
        ];

        const hiraganaToRomaji = {
            '„ÅÇ': 'a', '„ÅÑ': 'i', '„ÅÜ': 'u', '„Åà': 'e', '„Åä': 'o',
            '„Åã': 'ka', '„Åç': 'ki', '„Åè': 'ku', '„Åë': 'ke', '„Åì': 'ko',
            '„Åï': 'sa', '„Åó': 'shi', '„Åô': 'su', '„Åõ': 'se', '„Åù': 'so',
            '„Åü': 'ta', '„Å°': 'chi', '„Å§': 'tsu', '„Å¶': 'te', '„Å®': 'to',
            '„Å™': 'na', '„Å´': 'ni', '„Å¨': 'nu', '„Å≠': 'ne', '„ÅÆ': 'no',
            '„ÅØ': 'ha', '„Å≤': 'hi', '„Åµ': 'fu', '„Å∏': 'he', '„Åª': 'ho',
            '„Åæ': 'ma', '„Åø': 'mi', '„ÇÄ': 'mu', '„ÇÅ': 'me', '„ÇÇ': 'mo',
            '„ÇÑ': 'ya', '„ÇÜ': 'yu', '„Çà': 'yo',
            '„Çâ': 'ra', '„Çä': 'ri', '„Çã': 'ru', '„Çå': 're', '„Çç': 'ro',
            '„Çè': 'wa', '„Çí': 'wo', '„Çì': 'n',
            '„Åå': 'ga', '„Åé': 'gi', '„Åê': 'gu', '„Åí': 'ge', '„Åî': 'go',
            '„Åñ': 'za', '„Åò': 'ji', '„Åö': 'zu', '„Åú': 'ze', '„Åû': 'zo',
            '„Å†': 'da', '„Å¢': 'di', '„Å•': 'du', '„Åß': 'de', '„Å©': 'do',
            '„Å∞': 'ba', '„Å≥': 'bi', '„Å∂': 'bu', '„Åπ': 'be', '„Åº': 'bo',
            '„Å±': 'pa', '„Å¥': 'pi', '„Å∑': 'pu', '„Å∫': 'pe', '„ÅΩ': 'po',
            '„Åç„ÇÉ': 'kya', '„Åç„ÇÖ': 'kyu', '„Åç„Çá': 'kyo',
            '„Åó„ÇÉ': 'sha', '„Åó„ÇÖ': 'shu', '„Åó„Çá': 'sho',
            '„Å°„ÇÉ': 'cha', '„Å°„ÇÖ': 'chu', '„Å°„Çá': 'cho',
            '„Å´„ÇÉ': 'nya', '„Å´„ÇÖ': 'nyu', '„Å´„Çá': 'nyo',
            '„Å≤„ÇÉ': 'hya', '„Å≤„ÇÖ': 'hyu', '„Å≤„Çá': 'hyo',
            '„Åø„ÇÉ': 'mya', '„Åø„ÇÖ': 'myu', '„Åø„Çá': 'myo',
            '„Çä„ÇÉ': 'rya', '„Çä„ÇÖ': 'ryu', '„Çä„Çá': 'ryo',
            '„Åé„ÇÉ': 'gya', '„Åé„ÇÖ': 'gyu', '„Åé„Çá': 'gyo',
            '„Åò„ÇÉ': 'ja', '„Åò„ÇÖ': 'ju', '„Åò„Çá': 'jo',
            '„Å≥„ÇÉ': 'bya', '„Å≥„ÇÖ': 'byu', '„Å≥„Çá': 'byo',
            '„Å¥„ÇÉ': 'pya', '„Å¥„ÇÖ': 'pyu', '„Å¥„Çá': 'pyo',
            '„Å≠„Åì': 'neko', '„ÅÑ„Å¨': 'inu', '„ÅÜ„Åæ': 'uma', '„Å®„Çä': 'tori',
            '„Åï„Åã„Å™': 'sakana', '„ÅØ„Å™': 'hana', '„Åù„Çâ': 'sora', '„Åã„Çè': 'kawa'
        };

        let currentLevel = 1;
        let currentScore = 0;
        let currentQuestion = '';
        let currentAnswer = '';
        let currentInput = '';
        let comboCount = 0;
        let shouldShowHint = true;
        let totalQuestionsInLevel = 0;

        // Ê≠£Ëß£„É°„ÉÉ„Çª„Éº„Ç∏„ÅÆ„Éê„É™„Ç®„Éº„Ç∑„Éß„É≥
        const successMessages = [
            '‚≠ê „Åõ„ÅÑ„Åã„ÅÑÔºÅ',
            '‚ú® „Åô„Åî„ÅÑÔºÅ',
            'üéâ „ÇÑ„Å£„Åü„Å≠ÔºÅ',
            'üëè „Åô„Å∞„Çâ„Åó„ÅÑÔºÅ',
            'üí´ „Åã„Çì„Å∫„ÅçÔºÅ',
            'üåü „Åï„ÅÑ„Åì„ÅÜÔºÅ'
        ];

        const comboMessages = [
            'üî• „Ç≥„É≥„ÉúÔºÅ',
            '‚ö° „Çå„Çì„Åû„ÅèÔºÅ',
            'üí™ „Å°„Çá„ÅÜ„Åó „ÅÑ„ÅÑ„Å≠ÔºÅ',
            'üöÄ „Åô„Åî„ÅÑ„ÅûÔºÅ'
        ];

        function createKeyboard() {
            const keyboard = document.getElementById('keyboard');
            // Êó¢Â≠ò„ÅÆ„Ç≠„Éº„Éú„Éº„Éâ„Çí„ÇØ„É™„Ç¢
            keyboard.innerHTML = '';

            const layout = [
                ['1', '2', '3', '4', '5', '6', '7', '8', '9', '0'],
                ['q', 'w', 'e', 'r', 't', 'y', 'u', 'i', 'o', 'p'],
                ['a', 's', 'd', 'f', 'g', 'h', 'j', 'k', 'l'],
                ['z', 'x', 'c', 'v', 'b', 'n', 'm']
            ];

            layout.forEach(row => {
                const rowDiv = document.createElement('div');
                rowDiv.className = 'keyboard-row';
                row.forEach(key => {
                    const keyDiv = document.createElement('div');
                    keyDiv.className = 'key';
                    keyDiv.textContent = key.toUpperCase();
                    keyDiv.id = `key-${key}`;
                    rowDiv.appendChild(keyDiv);
                });
                keyboard.appendChild(rowDiv);
            });
        }

        function updateRomajiGuide() {
            const guideGrid = document.getElementById('guideGrid');
            guideGrid.innerHTML = '';

            const currentLevelData = levels[currentLevel - 1];
            currentLevelData.chars.forEach(char => {
                const romaji = hiraganaToRomaji[char];
                if (romaji) {
                    const item = document.createElement('div');
                    item.className = 'guide-item';
                    item.innerHTML = `
                        <div class="guide-hiragana">${char}</div>
                        <div class="guide-romaji">${romaji}</div>
                    `;
                    guideGrid.appendChild(item);
                }
            });
        }

        function startGame() {
            document.getElementById('startScreen').style.display = 'none';
            document.getElementById('playScreen').style.display = 'block';
            document.getElementById('homeButton').classList.add('show');
            createKeyboard();
            updateRomajiGuide();
            nextQuestion();
        }

        function goHome() {
            document.getElementById('startScreen').style.display = 'block';
            document.getElementById('playScreen').style.display = 'none';
            document.getElementById('homeButton').classList.remove('show');
            // „Ç≤„Éº„É†Áä∂ÊÖã„Çí„É™„Çª„ÉÉ„Éà
            currentLevel = 1;
            currentScore = 0;
            comboCount = 0;
            totalQuestionsInLevel = 0;
            document.getElementById('level').textContent = currentLevel;
            const currentLevelData = levels[currentLevel - 1];
            document.getElementById('score').textContent = currentScore + '/' + currentLevelData.questionsToPass;
            document.getElementById('progress').style.width = '0%';
        }

        function nextQuestion() {
            const levelData = levels[currentLevel - 1];
            const randomChar = levelData.chars[Math.floor(Math.random() * levelData.chars.length)];
            currentQuestion = randomChar;
            currentAnswer = hiraganaToRomaji[randomChar];
            currentInput = '';
            totalQuestionsInLevel++;

            // „Éí„É≥„ÉàË°®Á§∫„ÅÆÂà§ÂÆö
            const hintRate = levelData.hintRate;
            shouldShowHint = Math.random() < hintRate;

            // ÂïèÈ°å„Ç®„É™„Ç¢„ÅÆËÉåÊôØËâ≤„Çí„É¨„Éô„É´„ÉÜ„Éº„Éû„Å´Â§âÊõ¥
            const questionArea = document.getElementById('questionArea');
            questionArea.style.background = `linear-gradient(135deg, ${levelData.theme}, #FFEB3B)`;

            document.getElementById('questionHiragana').textContent = currentQuestion;
            document.getElementById('questionRomaji').textContent = currentAnswer;
            document.getElementById('inputDisplay').textContent = '';
            document.getElementById('feedback').textContent = '';
            document.getElementById('feedback').className = 'feedback';

            highlightNextKey();
        }

        function highlightNextKey() {
            // „Åô„Åπ„Å¶„ÅÆ„Ç≠„Éº„ÅÆ„Éè„Ç§„É©„Ç§„Éà„ÇíËß£Èô§
            document.querySelectorAll('.key').forEach(key => {
                key.classList.remove('highlight');
            });

            // „Éí„É≥„Éà„ÇíË°®Á§∫„Åô„ÇãÂ†¥Âêà„ÅÆ„Åø„Éè„Ç§„É©„Ç§„Éà
            if (shouldShowHint && currentInput.length < currentAnswer.length) {
                const nextChar = currentAnswer[currentInput.length].toLowerCase();
                const keyElement = document.getElementById(`key-${nextChar}`);
                if (keyElement) {
                    keyElement.classList.add('highlight');
                }
            }
        }

        document.addEventListener('keydown', (e) => {
            if (document.getElementById('playScreen').style.display === 'none') return;
            if (document.getElementById('levelUpScreen').classList.contains('show')) return;

            const key = e.key.toLowerCase();

            if (currentInput.length < currentAnswer.length) {
                const expectedChar = currentAnswer[currentInput.length].toLowerCase();

                if (key === expectedChar) {
                    currentInput += key;
                    document.getElementById('inputDisplay').textContent = currentInput;

                    if (currentInput === currentAnswer) {
                        // Ê≠£Ëß£ÔºÅ
                        comboCount++;
                        currentScore++;

                        // „É°„ÉÉ„Çª„Éº„Ç∏„ÅÆÈÅ∏Êäû
                        let message = successMessages[Math.floor(Math.random() * successMessages.length)];

                        // „Ç≥„É≥„Éú„É°„ÉÉ„Çª„Éº„Ç∏„ÅÆËøΩÂä†
                        if (comboCount >= 3) {
                            const comboMsg = comboMessages[Math.floor(Math.random() * comboMessages.length)];
                            message = message + ' ' + comboMsg + ' (x' + comboCount + ')';
                        }

                        document.getElementById('feedback').textContent = message;
                        document.getElementById('feedback').className = 'feedback correct';
                        updateScore();

                        setTimeout(() => {
                            const currentLevelData = levels[currentLevel - 1];
                            if (currentScore >= currentLevelData.questionsToPass) {
                                levelUp();
                            } else {
                                nextQuestion();
                            }
                        }, 1000);
                    } else {
                        highlightNextKey();
                    }
                } else {
                    // ‰∏çÊ≠£Ëß£
                    comboCount = 0; // „Ç≥„É≥„Éú„É™„Çª„ÉÉ„Éà
                    const hintText = shouldShowHint ? '' : expectedChar.toUpperCase() + ' „Çí „Åä„Åó„Å¶ÔºÅ';
                    document.getElementById('feedback').textContent = '‚ùå „Å°„Åå„ÅÜ„ÇàÔºÅ ' + hintText;
                    document.getElementById('feedback').className = 'feedback wrong';
                }
            }
        });

        function updateScore() {
            const currentLevelData = levels[currentLevel - 1];
            const maxScore = currentLevelData.questionsToPass;
            document.getElementById('score').textContent = currentScore + '/' + maxScore;
            const progress = (currentScore / maxScore) * 100;
            document.getElementById('progress').style.width = progress + '%';
        }

        function levelUp() {
            if (currentLevel < levels.length) {
                currentLevel++;
                currentScore = 0;
                comboCount = 0;
                totalQuestionsInLevel = 0;
                document.getElementById('level').textContent = currentLevel;
                document.getElementById('newLevel').textContent = currentLevel;
                document.getElementById('overlay').classList.add('show');
                document.getElementById('levelUpScreen').classList.add('show');
                updateRomajiGuide();
            } else {
                alert('üéä „Åä„ÇÅ„Åß„Å®„ÅÜÔºÅ „Åú„Çì„Å∂ „ÇØ„É™„Ç¢ „Åó„Åü„ÇàÔºÅ üéä\n„ÅÇ„Å™„Åü„ÅØ „Çø„Ç§„Éî„É≥„Ç∞ „Éû„Çπ„Çø„Éº „Å†ÔºÅ');
                currentScore = 0;
            }
            updateScore();
        }

        function continuePlaying() {
            document.getElementById('overlay').classList.remove('show');
            document.getElementById('levelUpScreen').classList.remove('show');
            nextQuestion();
        }
    </script>
</body>
</html>
